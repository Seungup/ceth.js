{"mappings":"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","sources":["src/core/graphic/calculation.worker.ts","src/index.ts","src/constants.ts","src/app/factory.ts","src/core/worker-factory.ts","src/core/core-thread.ts","src/core/graphic/graphic.component.ts","src/core/camera/camera.component.ts","src/app/object.renderer.ts","src/app/object.manager.ts","src/core/geometries/Geometries.ts","src/core/geometries/EarthGeometry.ts","src/utils.ts","src/interface.ts","src/test.ts"],"sourcesContent":["import { expose } from 'comlink';\r\nimport { CesiumWGS84, ThreeWGS84, ThreeWGS84ToCesiumWGS84 } from '../..';\r\n\r\nexport class CalculationWorker {\r\n\tcalculationObjectVisible(\r\n\t\tobjectPosition: ThreeWGS84,\r\n\t\tcurrentPosition: CesiumWGS84\r\n\t): boolean {\r\n\t\tobjectPosition = ThreeWGS84ToCesiumWGS84(objectPosition);\r\n\r\n\t\tlet objLon = objectPosition.longitude;\r\n\t\tlet objLat = objectPosition.latitude;\r\n\r\n\t\tlet curLon = currentPosition.longitude;\r\n\t\tlet curLat = currentPosition.latitude;\r\n\r\n\t\tif (Math.abs(objLon - curLat) > 300) {\r\n\t\t\tif (objLon < 0) {\r\n\t\t\t\tobjLon += 360;\r\n\t\t\t} else {\r\n\t\t\t\tcurLon += 360;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst lonGap = Math.abs(objLon - curLon);\r\n\t\tconst latGap = Math.abs(objLat - curLat);\r\n\r\n\t\tconst accpectableGapSize = 50;\r\n\r\n\t\treturn lonGap < accpectableGapSize && latGap < accpectableGapSize;\r\n\t}\r\n}\r\n\r\nexpose(new CalculationWorker());\r\n","export { REVISION } from './constants';\r\nexport { InterfcaeFactory } from './app/factory';\r\nexport * from './core/geometries/Geometries';\r\nexport * from './utils';\r\nexport * from './interface';\r\nexport { makeTeapotGeometry } from './test';\r\n","export const REVISION = '0dev';\r\nexport const EARTH_RADIUS = 6378137;\r\n","import { SingletonWorkerFactory } from '../core/worker-factory';\r\nimport { Viewer } from 'cesium';\r\nimport { transfer } from 'comlink';\r\nimport { ObjectRenderer } from './object.renderer';\r\nimport { ObjectManager } from './object.manager';\r\n\r\nexport class InterfcaeFactory {\r\n\tprivate readonly coreWrapper =\r\n\t\tSingletonWorkerFactory.getWrapper('CoreThread');\r\n\r\n\tprivate readonly container: HTMLDivElement;\r\n\tconstructor() {\r\n\t\tthis.container = document.createElement('div');\r\n\t\tthis.container.id = 'ThreeContainer';\r\n\t\tthis.container.style.position = 'absolute';\r\n\t\tthis.container.style.top = '0';\r\n\t\tthis.container.style.left = '0';\r\n\t\tthis.container.style.height = '100%';\r\n\t\tthis.container.style.width = '100%';\r\n\t\tthis.container.style.margin = '0';\r\n\t\tthis.container.style.overflow = 'hidden';\r\n\t\tthis.container.style.padding = '0';\r\n\t\tthis.container.style.pointerEvents = 'none';\r\n\r\n\t\tconst canvas = document.createElement('canvas');\r\n\t\tthis.container.append(canvas);\r\n\r\n\t\t// @ts-ignore\r\n\t\tconst offscreen = canvas.transferControlToOffscreen();\r\n\t\toffscreen.width = canvas.clientWidth;\r\n\t\toffscreen.height = canvas.clientHeight;\r\n\r\n\t\t// @ts-ignore\r\n\t\tthis.coreWrapper.init(transfer(offscreen, [offscreen])).then(() => {\r\n\t\t\tthis.coreWrapper.setPixelRatio(window.devicePixelRatio);\r\n\t\t});\r\n\t}\r\n\r\n\tcreateObjectManager() {\r\n\t\treturn new ObjectManager();\r\n\t}\r\n\r\n\tcreateRenderer(viewer: Viewer) {\r\n\t\tconst root = viewer.container.parentElement;\r\n\t\tif (!root) {\r\n\t\t\tthrow new Error('cannot fond parent element');\r\n\t\t} else {\r\n\t\t\troot.append(this.container);\r\n\t\t}\r\n\t\tif (viewer.useDefaultRenderLoop) {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'Please set Cesium viewer.useDefaultRenderLoop = false for syncronize animation frame to this plug-in'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn new ObjectRenderer(viewer);\r\n\t}\r\n}\r\n","import { wrap, Remote } from 'comlink';\r\nimport CoreThread from './core-thread';\r\nimport { CalculationWorker } from './graphic/calculation.worker';\r\n\r\ninterface WorkerMap {\r\n\tCoreThread: CoreThread;\r\n\tCalculationWorker: CalculationWorker;\r\n}\r\nexport const WorkerURL = {\r\n\tCoreThread: new URL('./core-thread', import.meta.url),\r\n\tCalculationWorker: new URL('./graphic/calculation.worker', import.meta.url),\r\n} as const;\r\n\r\nexport type WorkerURL = typeof WorkerURL[keyof typeof WorkerURL];\r\n\r\nexport class SingletonWorkerFactory {\r\n\tprivate static readonly workerMap = new Map<URL, Worker>();\r\n\tstatic getWorker<T extends keyof WorkerMap>(workerClassName: T): Worker {\r\n\t\tlet worker: Worker;\r\n\t\tconst workerURL = WorkerURL[workerClassName];\r\n\t\tif (!this.workerMap.has(workerURL)) {\r\n\t\t\tworker = new Worker(workerURL, { type: 'module' });\r\n\t\t\tthis.workerMap.set(workerURL, worker);\r\n\t\t} else {\r\n\t\t\tworker = this.workerMap.get(workerURL)!;\r\n\t\t}\r\n\t\treturn worker;\r\n\t}\r\n\r\n\tprivate static readonly wrapperMap = new Map<URL, Remote<any>>();\r\n\tstatic getWrapper<T extends keyof WorkerMap>(\r\n\t\tworkerClassName: T\r\n\t): Remote<WorkerMap[T]> {\r\n\t\tconst worker = SingletonWorkerFactory.getWorker(workerClassName);\r\n\t\tconst workerURL = WorkerURL[workerClassName];\r\n\r\n\t\tlet wrapper: Remote<WorkerMap[T]>;\r\n\t\tif (!this.wrapperMap.has(workerURL)) {\r\n\t\t\twrapper = wrap<WorkerMap[T]>(worker);\r\n\t\t\tthis.wrapperMap.set(workerURL, wrapper);\r\n\t\t} else {\r\n\t\t\twrapper = this.wrapperMap.get(workerURL)! as Remote<WorkerMap[T]>;\r\n\t\t}\r\n\r\n\t\treturn wrapper;\r\n\t}\r\n}\r\n","import { expose } from 'comlink';\r\nimport { GraphicComponent, RenderParam } from './graphic/graphic.component';\r\nimport { Matrix4, Object3D, ObjectLoader } from 'three';\r\nimport { ThreeWGS84 } from '..';\r\n\r\ninterface QueryResult {\r\n\tisExist: boolean;\r\n\tobject: Object3D | undefined;\r\n}\r\n\r\nexport default class CoreThread {\r\n\tprivate readonly graphicComponent = GraphicComponent.getInstance();\r\n\tprivate readonly objectLoader = new ObjectLoader();\r\n\r\n\tinit(canvas: HTMLCanvasElement) {\r\n\t\tthis.graphicComponent.init(canvas);\r\n\t}\r\n\r\n\tsetPixelRatio(value: number) {\r\n\t\tthis.graphicComponent.setPixelRatio(value);\r\n\t}\r\n\r\n\trender(param: RenderParam) {\r\n\t\tthis.graphicComponent.render(param);\r\n\t}\r\n\r\n\tprivate getObject(value: number | string): QueryResult {\r\n\t\tlet object: Object3D | undefined;\r\n\t\tif (typeof value === 'number') {\r\n\t\t\tobject = this.graphicComponent.getScene().getObjectById(value);\r\n\t\t}\r\n\r\n\t\tif (typeof value === 'string') {\r\n\t\t\tobject = this.graphicComponent.getScene().getObjectByName(value);\r\n\t\t}\r\n\r\n\t\treturn { isExist: !!object, object: object };\r\n\t}\r\n\r\n\tisExist(value: string | number) {\r\n\t\treturn this.getObject(value).isExist;\r\n\t}\r\n\r\n\thide(value: string | number) {\r\n\t\tconst result = this.getObject(value);\r\n\t\tif (result.isExist) {\r\n\t\t\tresult.object!.visible = false;\r\n\t\t}\r\n\t\treturn result.isExist;\r\n\t}\r\n\r\n\tshow(value: string | number) {\r\n\t\tconst result = this.getObject(value);\r\n\t\tif (result.isExist) {\r\n\t\t\tresult.object!.visible = true;\r\n\t\t}\r\n\t\treturn result.isExist;\r\n\t}\r\n\r\n\tadd(json: any) {\r\n\t\tconst object = this.objectLoader.parse(json);\r\n\t\tthis.graphicComponent.getScene().add(object);\r\n\t\treturn object.id;\r\n\t}\r\n\r\n\tupdateObject(id: number | string, json: any) {\r\n\t\tlet isSuccess = false;\r\n\t\tlet result = this.getObject(id);\r\n\t\tif (result.isExist) {\r\n\t\t\tconst updateObject = this.objectLoader.parse(json);\r\n\t\t\tresult.object!.copy(updateObject);\r\n\t\t\tisSuccess = true;\r\n\t\t}\r\n\t\treturn isSuccess;\r\n\t}\r\n\r\n\tupdatePosition(\r\n\t\tid: number | string,\r\n\t\tparam: {\r\n\t\t\tmatrix: Matrix4;\r\n\t\t\tposition: ThreeWGS84;\r\n\t\t}\r\n\t) {\r\n\t\tlet isSuccess = false;\r\n\t\tlet result = this.getObject(id);\r\n\t\tif (result.isExist) {\r\n\t\t\tconst object = result.object!;\r\n\t\t\tobject.applyMatrix4(param.matrix);\r\n\t\t\tobject.userData.wgs84 = param.position;\r\n\t\t\tisSuccess = true;\r\n\t\t}\r\n\t\treturn isSuccess;\r\n\t}\r\n\r\n\tdelete(value: number | string) {\r\n\t\tconst result = this.getObject(value);\r\n\t\tif (result.isExist) {\r\n\t\t\tthis.graphicComponent.getScene().remove(result.object!);\r\n\t\t}\r\n\t\treturn result.isExist;\r\n\t}\r\n}\r\n\r\nexpose(new CoreThread());\r\n","import * as THREE from 'three';\r\nimport * as Cesium from 'cesium';\r\nimport CameraComponent from '../camera/camera.component';\r\nimport { ThreeWGS84 } from '../..';\r\nimport { Remote, wrap } from 'comlink';\r\nimport { CalculationWorker } from './calculation.worker';\r\nimport { SingletonWorkerFactory } from '../worker-factory';\r\n\r\nexport interface CurrentExtent {\r\n\txmin: number;\r\n\tymin: number;\r\n\txmax: number;\r\n\tymax: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface CenterPosition {\r\n\tlon: number;\r\n\tlat: number;\r\n\theight: number;\r\n\tnow: CurrentExtent;\r\n}\r\n\r\nexport interface RenderParam {\r\n\tfov: number;\r\n\tnear: number;\r\n\tfar: number;\r\n\tcvm: Cesium.Matrix4;\r\n\tcivm: Cesium.Matrix4;\r\n\twidth: number;\r\n\theight: number;\r\n\tcenterPosition: CenterPosition;\r\n}\r\n\r\nexport class GraphicComponent {\r\n\tprivate static instance: GraphicComponent;\r\n\tprivate readonly calculationWorkerRemote: Remote<CalculationWorker>;\r\n\tprivate constructor(\r\n\t\tprivate readonly scene = new THREE.Scene(),\r\n\t\tprivate readonly cameraComponent = CameraComponent.getInstance()\r\n\t) {\r\n\t\tthis.calculationWorkerRemote =\r\n\t\t\tSingletonWorkerFactory.getWrapper('CalculationWorker');\r\n\t}\r\n\r\n\tstatic getInstance() {\r\n\t\treturn this.instance || (this.instance = new this());\r\n\t}\r\n\r\n\tgetScene() {\r\n\t\treturn this.scene;\r\n\t}\r\n\r\n\tsetPixelRatio(value: number): boolean {\r\n\t\tlet success = false;\r\n\t\tif (this.renderer) {\r\n\t\t\tthis.renderer.setPixelRatio(value);\r\n\t\t\tsuccess = true;\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\r\n\tprivate renderer?: THREE.WebGLRenderer;\r\n\tinit(canvas: HTMLCanvasElement) {\r\n\t\tthis.renderer = new THREE.WebGLRenderer({\r\n\t\t\tcanvas: canvas,\r\n\t\t\talpha: true,\r\n\t\t\tdepth: true,\r\n\t\t\tstencil: false,\r\n\t\t\tpreserveDrawingBuffer: true,\r\n\t\t\tpowerPreference: 'high-performance',\r\n\t\t\tantialias: true,\r\n\t\t\tpremultipliedAlpha: true,\r\n\t\t});\r\n\t\tthis.renderer.sortObjects = false;\r\n\t\tthis.renderer.autoClear = false;\r\n\t}\r\n\r\n\trender(param: RenderParam) {\r\n\t\tif (this.renderer) {\r\n\t\t\tthis.cameraComponent.synchronization({\r\n\t\t\t\taspect: param.width / param.height,\r\n\t\t\t\tfar: param.far,\r\n\t\t\t\tnear: param.near,\r\n\t\t\t\tfov: param.fov,\r\n\t\t\t\tcvm: param.cvm,\r\n\t\t\t\tcivm: param.civm,\r\n\t\t\t});\r\n\r\n\t\t\tthis.scene.traverse((object3D) => {\r\n\t\t\t\tconst position: ThreeWGS84 | undefined =\r\n\t\t\t\t\tobject3D.userData.wgs84;\r\n\t\t\t\tif (position) {\r\n\t\t\t\t\tthis.calculationWorkerRemote\r\n\t\t\t\t\t\t.calculationObjectVisible(position, {\r\n\t\t\t\t\t\t\tlongitude: param.centerPosition.lon,\r\n\t\t\t\t\t\t\tlatitude: param.centerPosition.lat,\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then((visible) => {\r\n\t\t\t\t\t\t\tobject3D.visible = visible;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.renderer.setSize(param.width, param.height, false);\r\n\t\t\tthis.renderer.clear();\r\n\t\t\tthis.renderer.render(this.scene, this.cameraComponent.getCamera());\r\n\t\t}\r\n\t}\r\n}\r\n","import { PerspectiveCamera } from 'three';\r\nimport { Matrix4 } from 'cesium';\r\n\r\nexport interface CameraSynchronizationParam {\r\n\taspect: number;\r\n\tfov: number;\r\n\tfar: number;\r\n\tnear: number;\r\n\tcvm: Matrix4;\r\n\tcivm: Matrix4;\r\n}\r\n\r\nexport default class CameraComponent {\r\n\tprivate static instance: CameraComponent;\r\n\tprivate readonly perspectiveCamera: PerspectiveCamera;\r\n\tprivate constructor() {\r\n\t\tthis.perspectiveCamera = new PerspectiveCamera();\r\n\t}\r\n\r\n\tgetCamera(): PerspectiveCamera {\r\n\t\treturn this.perspectiveCamera;\r\n\t}\r\n\r\n\tsynchronization(param: CameraSynchronizationParam) {\r\n\t\tthis.perspectiveCamera.matrixAutoUpdate = false;\r\n\r\n\t\tthis.perspectiveCamera.fov = param.fov;\r\n\t\tthis.perspectiveCamera.near = param.near;\r\n\t\tthis.perspectiveCamera.far = param.far;\r\n\t\tthis.perspectiveCamera.aspect = param.aspect;\r\n\r\n\t\tthis.perspectiveCamera.matrixWorld.set(\r\n\t\t\tparam.civm[0],\r\n\t\t\tparam.civm[4],\r\n\t\t\tparam.civm[8],\r\n\t\t\tparam.civm[12],\r\n\t\t\tparam.civm[1],\r\n\t\t\tparam.civm[5],\r\n\t\t\tparam.civm[9],\r\n\t\t\tparam.civm[13],\r\n\t\t\tparam.civm[2],\r\n\t\t\tparam.civm[6],\r\n\t\t\tparam.civm[10],\r\n\t\t\tparam.civm[14],\r\n\t\t\tparam.civm[3],\r\n\t\t\tparam.civm[7],\r\n\t\t\tparam.civm[11],\r\n\t\t\tparam.civm[15]\r\n\t\t);\r\n\t\tthis.perspectiveCamera.matrixWorldInverse.set(\r\n\t\t\tparam.cvm[0],\r\n\t\t\tparam.cvm[4],\r\n\t\t\tparam.cvm[8],\r\n\t\t\tparam.cvm[12],\r\n\t\t\tparam.cvm[1],\r\n\t\t\tparam.cvm[5],\r\n\t\t\tparam.cvm[9],\r\n\t\t\tparam.cvm[13],\r\n\t\t\tparam.cvm[2],\r\n\t\t\tparam.cvm[6],\r\n\t\t\tparam.cvm[10],\r\n\t\t\tparam.cvm[14],\r\n\t\t\tparam.cvm[3],\r\n\t\t\tparam.cvm[7],\r\n\t\t\tparam.cvm[11],\r\n\t\t\tparam.cvm[15]\r\n\t\t);\r\n\t\tthis.perspectiveCamera.updateProjectionMatrix();\r\n\t}\r\n\r\n\tstatic getInstance() {\r\n\t\treturn this.instance || (this.instance = new this());\r\n\t}\r\n}\r\n","import { Viewer } from 'cesium';\r\nimport {\r\n\tCenterPosition,\r\n\tCurrentExtent,\r\n\tRenderParam,\r\n} from '../core/graphic/graphic.component';\r\nimport { SingletonWorkerFactory } from '../core/worker-factory';\r\nimport {\r\n\tMath as CesiumMath,\r\n\tPerspectiveFrustum,\r\n\tCartesian2,\r\n\tEllipsoid,\r\n} from 'cesium';\r\n\r\nexport class ObjectRenderer {\r\n\tprivate readonly coreWrapper =\r\n\t\tSingletonWorkerFactory.getWrapper('CoreThread');\r\n\tprivate readonly viewer: Viewer;\r\n\r\n\tconstructor(viewer: Viewer) {\r\n\t\tthis.viewer = viewer;\r\n\t\tthis.coreWrapper.setPixelRatio(window.devicePixelRatio);\r\n\t}\r\n\r\n\tprivate _getCurrentExtent(): CurrentExtent {\r\n\t\tlet currentExtent: CurrentExtent = {\r\n\t\t\txmax: 0,\r\n\t\t\txmin: 0,\r\n\t\t\tymax: 0,\r\n\t\t\tymin: 0,\r\n\t\t\theight: 0,\r\n\t\t};\r\n\r\n\t\tconst viewer = this.viewer;\r\n\t\tconst ellipsoid = viewer.scene.globe.ellipsoid;\r\n\r\n\t\tconst car3_lt = viewer.camera.pickEllipsoid(\r\n\t\t\tnew Cartesian2(0, 0),\r\n\t\t\tellipsoid\r\n\t\t);\r\n\r\n\t\tconst car3_rb = viewer.camera.pickEllipsoid(\r\n\t\t\tnew Cartesian2(viewer.canvas.width, viewer.canvas.height),\r\n\t\t\tellipsoid\r\n\t\t);\r\n\r\n\t\tif (car3_lt && car3_rb) {\r\n\t\t\tconst carto_lt = ellipsoid.cartesianToCartographic(car3_lt);\r\n\t\t\tconst carto_rb = ellipsoid.cartesianToCartographic(car3_rb);\r\n\t\t\tcurrentExtent.xmin = CesiumMath.toDegrees(carto_lt.longitude);\r\n\t\t\tcurrentExtent.ymin = CesiumMath.toDegrees(carto_lt.latitude);\r\n\t\t\tcurrentExtent.xmax = CesiumMath.toDegrees(carto_rb.longitude);\r\n\t\t\tcurrentExtent.ymax = CesiumMath.toDegrees(carto_rb.latitude);\r\n\t\t} else if (!car3_lt && car3_rb) {\r\n\t\t\tconst canvas = viewer.canvas;\r\n\t\t\tlet car3_lt2 = null;\r\n\t\t\tlet yIndex = 0;\r\n\t\t\tdo {\r\n\t\t\t\tyIndex <= canvas.height ? (yIndex += 10) : canvas.height;\r\n\t\t\t\tcar3_lt2 = viewer.camera.pickEllipsoid(\r\n\t\t\t\t\tnew Cartesian2(0, yIndex),\r\n\t\t\t\t\tellipsoid\r\n\t\t\t\t);\r\n\t\t\t} while (!car3_lt2);\r\n\t\t\tconst carto_lt2 = ellipsoid.cartesianToCartographic(car3_lt2);\r\n\t\t\tconst carto_rb2 = ellipsoid.cartesianToCartographic(car3_rb);\r\n\t\t\tcurrentExtent.xmin = CesiumMath.toDegrees(carto_lt2.longitude);\r\n\t\t\tcurrentExtent.ymax = CesiumMath.toDegrees(carto_lt2.latitude);\r\n\t\t\tcurrentExtent.xmax = CesiumMath.toDegrees(carto_rb2.longitude);\r\n\t\t\tcurrentExtent.ymin = CesiumMath.toDegrees(carto_rb2.latitude);\r\n\t\t}\r\n\r\n\t\tcurrentExtent.height = Math.ceil(\r\n\t\t\tviewer.camera.positionCartographic.height\r\n\t\t);\r\n\r\n\t\treturn currentExtent;\r\n\t}\r\n\r\n\tprivate _getHeight() {\r\n\t\treturn this.viewer.scene.globe.ellipsoid.cartesianToCartographic(\r\n\t\t\tthis.viewer.camera.position\r\n\t\t).height;\r\n\t}\r\n\r\n\tprivate _getCenterPosition(): CenterPosition | undefined {\r\n\t\tconst windowPosition = new Cartesian2(\r\n\t\t\tthis.viewer.canvas.clientWidth / 2,\r\n\t\t\tthis.viewer.canvas.clientHeight / 2\r\n\t\t);\r\n\t\tconst result = this.viewer.camera.pickEllipsoid(windowPosition);\r\n\r\n\t\tif (result) {\r\n\t\t\tconst currentPosition =\r\n\t\t\t\tEllipsoid.WGS84.cartesianToCartographic(result);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tlon: (currentPosition.longitude * 180) / Math.PI,\r\n\t\t\t\tlat: (currentPosition.latitude * 180) / Math.PI,\r\n\t\t\t\theight: this._getHeight(),\r\n\t\t\t\tnow: this._getCurrentExtent(),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync render() {\r\n\t\tconst centerPosition = this._getCenterPosition();\r\n\t\tif (centerPosition) {\r\n\t\t\tconst renderParam: RenderParam = {\r\n\t\t\t\tfov: CesiumMath.toDegrees(\r\n\t\t\t\t\t(this.viewer.camera.frustum as PerspectiveFrustum).fovy\r\n\t\t\t\t),\r\n\t\t\t\tnear: this.viewer.camera.frustum.near,\r\n\t\t\t\tfar: this.viewer.camera.frustum.far,\r\n\t\t\t\tcivm: this.viewer.camera.inverseViewMatrix,\r\n\t\t\t\tcvm: this.viewer.camera.viewMatrix,\r\n\t\t\t\twidth: this.viewer.container.clientWidth,\r\n\t\t\t\theight: this.viewer.container.clientHeight,\r\n\t\t\t\tcenterPosition: centerPosition,\r\n\t\t\t};\r\n\t\t\tawait this.coreWrapper.render(renderParam);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Object3D } from 'three';\r\nimport { CesiumWGS84, CesiumWGS84ToThreeWGS84, localWGS84ToMattrix4 } from '..';\r\nimport { SingletonWorkerFactory } from '../core/worker-factory';\r\n\r\nexport type UniqueObjectId = number | string;\r\n\r\nexport interface RequestResult {\r\n\tobjectId: UniqueObjectId;\r\n\tresult: boolean;\r\n}\r\n\r\nexport class ObjectManager {\r\n\tprivate readonly coreWrapper =\r\n\t\tSingletonWorkerFactory.getWrapper('CoreThread');\r\n\r\n\tasync hide(id: UniqueObjectId): Promise<RequestResult> {\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: await this.coreWrapper.hide(id),\r\n\t\t};\r\n\t}\r\n\r\n\tasync show(id: UniqueObjectId): Promise<RequestResult> {\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: await this.coreWrapper.show(id),\r\n\t\t};\r\n\t}\r\n\r\n\tasync add(\r\n\t\tobject: Object3D,\r\n\t\tposition?: CesiumWGS84\r\n\t): Promise<RequestResult> {\r\n\t\tconst id = await this.coreWrapper.add(object.toJSON());\r\n\t\tif (position) {\r\n\t\t\treturn await this.updatePosition(id, position);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: true,\r\n\t\t};\r\n\t}\r\n\r\n\tasync addFromJSON(\r\n\t\tjson: any,\r\n\t\tposition?: CesiumWGS84\r\n\t): Promise<RequestResult> {\r\n\t\tconst id = await this.coreWrapper.add(json);\r\n\t\tif (position) {\r\n\t\t\treturn await this.updatePosition(id, position);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: true,\r\n\t\t};\r\n\t}\r\n\r\n\tasync delete(id: UniqueObjectId): Promise<RequestResult> {\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: await this.coreWrapper.delete(id),\r\n\t\t};\r\n\t}\r\n\r\n\tasync updateObject(\r\n\t\tid: UniqueObjectId,\r\n\t\tobject: Object3D\r\n\t): Promise<RequestResult> {\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: await this.coreWrapper.updateObject(id, object.toJSON()),\r\n\t\t};\r\n\t}\r\n\r\n\tasync updatePosition(\r\n\t\tid: UniqueObjectId,\r\n\t\tposition: CesiumWGS84\r\n\t): Promise<RequestResult> {\r\n\t\tposition = CesiumWGS84ToThreeWGS84(position);\r\n\t\tconst matrix = localWGS84ToMattrix4(position);\r\n\t\treturn {\r\n\t\t\tobjectId: id,\r\n\t\t\tresult: await this.coreWrapper.updatePosition(id, {\r\n\t\t\t\tmatrix: matrix,\r\n\t\t\t\tposition: position,\r\n\t\t\t}),\r\n\t\t};\r\n\t}\r\n}\r\n","export * from './EarthGeometry';\r\n","import { SphereGeometry } from 'three';\r\nimport { EARTH_RADIUS } from '../../constants';\r\n\r\nclass EarthGeometry extends SphereGeometry {\r\n\tconstructor(segments: number = 32) {\r\n\t\tsuper(EARTH_RADIUS, segments, segments);\r\n\t}\r\n}\r\n\r\nexport { EarthGeometry };\r\n","import {\r\n\tHeadingPitchRoll,\r\n\tTransforms,\r\n\tCartesian3,\r\n\tMath as CesiumMath,\r\n} from 'cesium';\r\n\r\nimport * as THREE from 'three';\r\nimport { CesiumWGS84, ThreeWGS84 } from './interface';\r\n\r\nfunction CesiumWGS84ToThreeWGS84(cesiumWGS84: CesiumWGS84): ThreeWGS84 {\r\n\treturn {\r\n\t\tlatitude: cesiumWGS84.longitude,\r\n\t\tlongitude: cesiumWGS84.latitude,\r\n\t};\r\n}\r\nfunction ThreeWGS84ToCesiumWGS84(ThreeWGS84: ThreeWGS84): CesiumWGS84 {\r\n\treturn {\r\n\t\tlatitude: ThreeWGS84.longitude,\r\n\t\tlongitude: ThreeWGS84.latitude,\r\n\t};\r\n}\r\n\r\nfunction rotationX(degrees: number) {\r\n\treturn new THREE.Matrix4().makeRotationX(CesiumMath.toRadians(degrees));\r\n}\r\n\r\nfunction applayRotation(object: THREE.BufferGeometry, degrees: number) {\r\n\tobject.applyMatrix4(rotationX(degrees));\r\n}\r\n\r\nfunction localWGS84ToMattrix4(position: ThreeWGS84): THREE.Matrix4 {\r\n\tconst wgs84Position = Cartesian3.fromDegrees(\r\n\t\tposition.longitude,\r\n\t\tposition.latitude\r\n\t);\r\n\tconst matrix = Transforms.headingPitchRollToFixedFrame(\r\n\t\twgs84Position,\r\n\t\tnew HeadingPitchRoll(0, 0, 0)\r\n\t);\r\n\r\n\tconst localToWgs84Mattrix = new THREE.Matrix4();\r\n\r\n\tlocalToWgs84Mattrix.set(\r\n\t\tmatrix[0],\r\n\t\tmatrix[4],\r\n\t\tmatrix[8],\r\n\t\tmatrix[12],\r\n\t\tmatrix[1],\r\n\t\tmatrix[5],\r\n\t\tmatrix[9],\r\n\t\tmatrix[13],\r\n\t\tmatrix[2],\r\n\t\tmatrix[6],\r\n\t\tmatrix[10],\r\n\t\tmatrix[14],\r\n\t\tmatrix[3],\r\n\t\tmatrix[7],\r\n\t\tmatrix[11],\r\n\t\tmatrix[15]\r\n\t);\r\n\r\n\treturn localToWgs84Mattrix;\r\n}\r\n\r\nfunction applyObjectWGS84Postion(\r\n\tobject: THREE.BufferGeometry,\r\n\tposition: CesiumWGS84\r\n) {\r\n\tposition = CesiumWGS84ToThreeWGS84(position);\r\n\tconst matrix = localWGS84ToMattrix4(position);\r\n\tobject.applyMatrix4(matrix);\r\n\tobject.userData.wgs84 = position;\r\n}\r\n\r\nexport {\r\n\tlocalWGS84ToMattrix4,\r\n\tapplayRotation,\r\n\tapplyObjectWGS84Postion,\r\n\tCesiumWGS84ToThreeWGS84,\r\n\tThreeWGS84ToCesiumWGS84,\r\n};\r\n","export interface CesiumWGS84 {\r\n\tlongitude: number;\r\n\tlatitude: number;\r\n}\r\n\r\nexport interface ThreeWGS84 {\r\n\tlongitude: number;\r\n\tlatitude: number;\r\n}\r\n","import { TeapotGeometry } from 'three/examples/jsm/geometries/TeapotGeometry';\r\nimport { applayRotation } from './utils';\r\n\r\nexport function makeTeapotGeometry(teapotSize: number = 10) {\r\n\tconst teapotGeometry = new TeapotGeometry(teapotSize);\r\n\tapplayRotation(teapotGeometry, 90);\r\n\treturn teapotGeometry;\r\n}\r\n"],"names":[],"version":3,"file":"calculation.worker.823e7fda.js.map","sourceRoot":"../"}